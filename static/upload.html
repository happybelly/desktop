<html>
<head>
    <title>Upload file</title>
	<link rel="stylesheet" href="https://storage.googleapis.com/code.getmdl.io/1.0.0/material.indigo-pink.min.css">
	<script src="https://storage.googleapis.com/code.getmdl.io/1.0.0/material.min.js"></script>
	<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
	<script src="https://rawgit.com/enyo/dropzone/master/dist/dropzone.js"></script>
	<link rel="stylesheet" href="css/dropzone.css">

</head>
<body>
    <div class="demo-layout mdl-layout mdl-layout--fixed-header mdl-js-layout mdl-color--grey-100">
      <header class="demo-header mdl-layout__header mdl-layout__header--scroll mdl-color--grey-100 mdl-color-text--grey-800">
        <div class="mdl-layout__header-row">
          <span class="mdl-layout-title">Upload document</span>
          <div class="mdl-layout-spacer"></div>
          <div class="mdl-textfield mdl-js-textfield mdl-textfield--expandable">
            <label class="mdl-button mdl-js-button mdl-button--icon" for="search">
              <i class="material-icons">search</i>
            </label>
            <div class="mdl-textfield__expandable-holder">
              <input class="mdl-textfield__input" type="text" id="search" />
              <label class="mdl-textfield__label" for="search">Enter your query...</label>
            </div>
          </div>
        </div>
      </header>
      <div class="demo-ribbon"></div>
      <main class="demo-main mdl-layout__content">
        <div class="demo-container mdl-grid">
          <div class="mdl-cell mdl-cell--2-col mdl-cell--hide-tablet mdl-cell--hide-phone"></div>
          <div class="demo-content mdl-color--white mdl-shadow--4dp content mdl-color-text--grey-800 mdl-cell mdl-cell--8-col">
          	<div id="dropzone" style="text-align:center;"><br/><br/><h2>Drop a file here</h2><br/><br/></div>
            <!--<form enctype="multipart/form-data" class="dropzone" action="/grind" method="post">
		      <input type="file" name="uploadfile" />
		      <input type="hidden" name="token" value="{{.}}"/>
		      <input type="submit" value="upload" />
			</form>-->
          </div>
        </div>
        <footer class="demo-footer mdl-mini-footer">
          <div class="mdl-mini-footer--left-section">
            <ul class="mdl-mini-footer--link-list">
              <li><a href="#">Help</a></li>
              <li><a href="#">Privacy and Terms</a></li>
              <li><a href="#">User Agreement</a></li>
            </ul>
          </div>
        </footer>
      </main>
    </div>
    <script>
    // https://stackoverflow.com/questions/901115/
    function getParameterByName(name) {
    	name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
    	var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
        	results = regex.exec(location.search);
    	return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
	}

    var prefix = getParameterByName('prefix');

	var myDropzone = new Dropzone("div#dropzone", { 
		url: prefix + "/grind",
		paramName: "uploadfile",
    	init: function() {
        this.on("success", function(file, responseText) {
            console.log(responseText);
            var ret = JSON.parse(responseText);
            if (ret.Result !== 0) {
            	alert("This file has crashed the fact extractor with this message: " + ret.Message + ". Please send this file to Xiaocheng and blame her program for not working right!");
            } else {
	            window.location.href = "viewer/web/viewer.html?file=" + prefix + "/get/" + ret.ID + ".pdf&facts=" + prefix + "/get/" + ret.ID + ".fact.json";	
            }        
        });
    }});
    </script>
</body>
</html>